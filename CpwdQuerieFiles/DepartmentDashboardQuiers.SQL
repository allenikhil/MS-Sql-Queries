declare @pin_nActionUserID int=1252

SELECT TOP 10 1 as ntype ,nProcurementID, nTenderID, sTenderNo, nTenderType, nTenderCategory, mEstimatedCost, nStatus,(SELECT nCurrencyType FROM tblTenderDetails WHERE nProcurementID = T.nProcurementID) AS nCurrencyType,
nTenderEvalType,isnull(beAuctionApplicable,0) as beAuctionApplicable,isnull(Aid,0) AS Aid, 
dbo.AuctionEndDateTime(T.nProcurementID,T.aid)  as AEndDateTimeFlag, ISNULL(nobidAuctionFlag,0) AS nobidAuctionFlag,dbo.AuctionStartDateTime(T.nProcurementID,T.aid) AS AuctionStartDateTimeFlag,ISNULL(bJorFlag,0) AS bJorFlag,[dbo].[GetJorEvaluationStatus](T.nProcurementID) stagejorfilledStatus,0 as IsTenderOpened, 0 as nStagesCount, dtLastModified AS dtModified, 'Initiation of Corrigendum' AS nTenderStatus FROM tblTender T 
WHERE  nTenderModifier = @pin_nActionUserID  AND nStatus IN (105,109)  AND nProcurementID NOT IN(SELECT nProcurementID FROM tblTenderCorrigendum WHERE 
nStatus  IN(102,105,109))
union	
SELECT TOP 10 2 as ntype , nProcurementID, nTenderID, sTenderNo, nTenderType, nTenderCategory, mEstimatedCost, nStatus ,(SELECT nCurrencyType FROM tblTenderDetails WHERE nProcurementID = T.nProcurementID) AS nCurrencyType,nTenderEvalType,isnull(beAuctionApplicable,0) as beAuctionApplicable,isnull(Aid,0) as Aid, dbo.AuctionEndDateTime(T.nProcurementID,T.aid)  as AEndDateTimeFlag, ISNULL(nobidAuctionFlag,0) AS nobidAuctionFlag,dbo.AuctionStartDateTime(T.nProcurementID,T.aid) AS AuctionStartDateTimeFlag,ISNULL(bJorFlag,0) AS bJorFlag,[dbo].[GetJorEvaluationStatus](T.nProcurementID) stagejorfilledStatus, 0 as IsTenderOpened,(select count(nProcurementID) from tblTenderStages WHERE nProcurementID = T.nProcurementID) as nStagesCount, (select top 1 dtLastModified from tblTenderStages WHERE nProcurementID = T.nProcurementID order by dtLastModified desc)  as dtModified,'Tender Under Creation' AS nTenderStatus  FROM tblTender T WHERE nStatus=105 and nCreatedBy =@pin_nActionUserID
union
SELECT TOP 10 3 as ntype ,nProcurementID, nTenderID, sTenderNo, nTenderType, nTenderCategory, mEstimatedCost, nStatus , (SELECT nCurrencyType FROM tblTenderDetails WHERE nProcurementID = T.nProcurementID) AS nCurrencyType,nTenderEvalType,isnull(beAuctionApplicable,0) as beAuctionApplicable,isnull(Aid,0) as Aid, dbo.AuctionEndDateTime(T.nProcurementID,T.aid)  as AEndDateTimeFlag, ISNULL(nobidAuctionFlag,0) AS nobidAuctionFlag,dbo.AuctionStartDateTime(T.nProcurementID,T.aid) AS AuctionStartDateTimeFlag,ISNULL(bJorFlag,0) AS bJorFlag,[dbo].[GetJorEvaluationStatus](T.nProcurementID) stagejorfilledStatus,dbo.IsTenderOpened(nProcurementID) as IsTenderOpened, 0 as nStagesCount, (select top 1 dtBidOpened from tblTenderStages WHERE nProcurementID = T.nProcurementID order by dtBidOpened desc)  as dtModified, dbo.GetEvaluationStatus(nProcurementID) AS nTenderStatus    FROM tblTender T WHERE  nStatus=105 and dtBidSubmissionClosingDate < GETDATE() AND nProcurementID in(SELECT  DISTINCT nProcurementID FROM tblTenderStages WHERE (nOpenerUserID = @pin_nActionUserID OR nNextApprovingUserID = @pin_nActionUserID) UNION SELECT  DISTINCT nProcurementID FROM tblStageEvaluators WHERE nUserID = @pin_nActionUserID UNION SELECT  DISTINCT nProcurementID FROM tblScheduleEvaluated WHERE  nNextApprovingUserID = @pin_nActionUserID)
union
SELECT TOP 10 4 as ntype ,T.nProcurementID, nTenderID, sTenderNo, nTenderType, nTenderCategory, mEstimatedCost, DBO.getDependentStageEvalStatus(T.nProcurementID) AS nStatus,(SELECT nCurrencyType FROM tblTenderDetails WHERE nProcurementID = T.nProcurementID) AS nCurrencyType,nTenderEvalType,isnull(beAuctionApplicable,0) as beAuctionApplicable,isnull(Aid,0) as Aid, dbo.AuctionEndDateTime(T.nProcurementID,T.aid)  as AEndDateTimeFlag, ISNULL(nobidAuctionFlag,0) AS nobidAuctionFlag,dbo.AuctionStartDateTime(T.nProcurementID,T.aid) AS AuctionStartDateTimeFlag,ISNULL(bJorFlag,0) AS bJorFlag,[dbo].[GetJorEvaluationStatus](T.nProcurementID) stagejorfilledStatus, 0 as IsTenderOpened, 0 as nStagesCount, dtBidSubmissionClosingDate as dtModified, 'Decrypt Tender' AS nTenderStatus FROM    tblTender T 
	    INNER JOIN  tblTenderDecrypter  TD ON T.nProcurementID = TD.nProcurementID
WHERE   T.bDecrypted=0 AND TD.bDecrypted=0 AND nUserID = @pin_nActionUserID AND T.nstatus=105 AND dtBidSubmissionClosingDate < getdate()  AND (SELECT COUNT(nProcurementID) FROM tblSupplierBid WHERE nProcurementID = T.nProcurementID) > 0 ORDER BY dtModified DESC

